services:
  backend:
    healthcheck:
      test:
        - CMD-SHELL
        - curl -fsS http://127.0.0.1:5000/health || exit 1
      interval: 15s
      timeout: 3s
      retries: 10
      start_period: 20s
    deploy:
      resources:
        limits:
          cpus: "0.50"
          memory: 512M
        reservations:
          cpus: "0.25"
          memory: 256M
  db:
    healthcheck:
      test:
        - CMD-SHELL
        - pg_isready -U $${POSTGRES_USER:-tenantra} -d $${POSTGRES_DB:-tenantra}
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 10s
    deploy:
      resources:
        limits:
          cpus: "1.00"
          memory: 1024M
        reservations:
          cpus: "0.50"
          memory: 512M
